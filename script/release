#!/bin/bash

if [ -z "$EQUINOX_BETA" ]; then
  VERSION=$(cat VERSION)
  CHANNEL=stable
else
  VERSION=$(git rev-parse --short HEAD)
  CHANNEL=beta
fi

if [ -z "$EQUINOX_SIGNING_KEY" ]; then
	echo "Installing $VERSION to $CHANNEL with EQUINOX_SIGNING_KEY"
	/usr/local/bin/equinox release \
	--version=$VERSION \
	--channel=$CHANNEL \
	--platforms="darwin_amd64 linux_amd64" \
	--app=$EQUINOX_RELAX_APP_ID \
	--token=$EQUINOX_CREDENTIAL \
	github.com/zerobotlabs/relax
else
	echo "Installing $VERSION to $CHANNEL with EQUINOX_SIGNING_KEY_FILE"
	/usr/local/bin/equinox release \
	--version=$VERSION \
	--channel=$CHANNEL \
	--platforms="darwin_amd64 linux_amd64" \
	--signing-key=$EQUINOX_SIGNING_KEY_FILE \
	--app=$EQUINOX_RELAX_APP_ID \
	--token=$EQUINOX_CREDENTIAL \
	github.com/zerobotlabs/relax
fi
